<html> <!DOCTYPE html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <title>Deploy Jekyll to S3 With S3_website</title> <meta name="description" content="I’d originally set this up to deploy to S3 using the new-ish Octopress-Deploy gem but after using it a bit I’ve found that it’s still too rough to be my goto."> <link href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/css/main.css" media="screen, projection" rel="stylesheet" type="text/css"> <link rel="canonical" href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/blog/2014/deploy-jekyll-to-s3-with-s3_website"> <link rel="alternate" type="application/atom+xml" title="Slim Pickins Jekyll Theme" href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/feed.xml"/> </head> <body> <main class="wrap"> <header role="banner"> <a href="/"><img src="//chrisanthropic.github.io/slim-pickins-jekyll-theme//images/banner.jpg" alt="Slim Pickins Jekyll Theme banner image" title="Slim Pickins Jekyll Theme banner image" class="center"></a> </header> <nav class="navbar"> <nav class="row"> <div id="nav"> <ul class="columns large-8 left primary-nav"> <li id="toggleMenu"><a href="#nav">Menu</a></li> <li id="hideMenu"><a href="#toggleMenu">Menu</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/">home</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/blog/">blog</a></li> <li class="dropdown"> <a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme">documentation</a> <ul> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/sass.html">sass</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/grid.html">grid</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/nav.html">navigation</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/banner.html">banner</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/footer.html">sticky footer</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/rakefile.html">rakefile</a></li> </ul> </li> <li class="dropdown"> <a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme">use</a> <ul> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/installation.html">installation</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/configuration.html">configuration</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/deploy.html">deployment</a></li> <li><a href="//chrisanthropic.github.io/slim-pickins-jekyll-theme/documentation/use.html">basic use</a></li> </ul> </li> </ul> <ul class="columns large-4 right primary-nav"> <a href="https://chrisanthropic.github.io/slim-pickins-jekyll-theme/feed.xml"><li class="right icon-feed"></li></a> <a href="#"><li class="right icon-googleplus"></li></a> <a href="#"><li class="right icon-facebook"></li></a> <a href="#"><li class="right icon-tumblr"></li></a> <a href="https://twitter.com/"><li class="right icon-twitter"></li></a> <a href="https://github.com/chrisanthropic/slim-pickins-jekyll-theme"><li class="right icon-github"></li></a> </ul> </div> </nav> </nav> <article class="row post-content"> <header class="post-header"> <h1 class="post-title">Deploy Jekyll to S3 With S3_website</h1> <p class="post-meta">Dec 5, 2014</p> </header> <p>I’d originally set this up to deploy to S3 using the new-ish Octopress-Deploy gem but after using it a bit I’ve found that it’s still too rough to be my goto.</p> <p>The main benefits of switching to S3_website are:</p> <ul> <li>Incremental deploy. It only pushes files that have been updated.</li> <li>Proper metadata. Octopress-deploy marked all of my files as <code>Content-Type: image/jpeg</code> </li> <li>Caching. Setting max-age is very simple with this plugin.</li> <li>Gzip. The plugin can automatically compress the files before pushing it to S3. This makes things load faster and reduces your bandwidth costs.</li> </ul> <p>Below are the steps I took to migrate from <code>octopress-deploy</code> to <a href="https://github.com/laurilehmijoki/s3_website">S3_website</a>.</p> <ul> <li>First I added <code>s3_website.yml</code> to .gitignore since it’ll hold our S3 credentials and we don’t want those public.</li> <li>add s3_website to Gemfile</li> <li>Install the gem by running <code>bundle install --binstubs --path=vendor</code></li> <li>Create the default config by running <code>bundle exec s3_website cfg create</code></li> <li>add your S3 credentials to <code>s3_config.yml</code></li> <li><strong>GZIP</strong> add <code>gzip: true</code> to <code>s3_website.yml</code></li> <li><strong>CACHE</strong> Update max-age in <code>s3_website.yml</code><br/> <code> max_age: "css/*": 604800 "*": 300 </code></li> <li>update Rakefile build command to <code>system "bundle exec s3_website push"</code></li> <li>bundle exec rake build</li> <li>run the initial push with the –force flag just to make sure it updates cache metadata for all files<br/> <code>bundle exec s3_website push --force</code></li> <li>Login to Cloudflare and purge the cache to make sure your serving up your new gzip/cache files</li> </ul> <p>From now on you can run <code>bundle exec rake deploy</code> and the S3_website plugin will compress all of your files, add cache headers to them, and push any that have changed to your S3 bucket.</p> </article> </main> <footer class="site-footer"> <div class="row"> <div class="small-6 columns"> </div> <div class="small-6 columns"> </div> </div> </footer> </body> </html>